{% extends 'base.html' %}
{% block body %}


<style>
    .ur {
        font-family: Nafees Nastaleeq;
        font-style: normal;
        font-weight: normal;
        line-height: 2.2;
        white-space: pre-wrap;
        font-size: 20px;
    }

    .listening {
        background-color: brown;
        border: 1px solid brown;
        color: #fff;
    }

    #output p {
        padding: 10px;
        border: 1px solid #aaaaaa60;
        border-radius: 10px;
    }
</style>

<style>
    .file-upload {
        border: 2px dashed #cccccc50;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }

    .file-upload__label {
        display: block;
        margin-bottom: 10px;
    }

    .file-upload.active {
        border-color: #666;
        border-radius: 10px;
    }

    .file-upload .file-upload__label:after {
        display: inline-block;
        margin: 0 5px;
    }

    .file-upload .file-upload__label:hover,
    .file-upload.active .file-upload__label {
        color: #666;
    }

    .file-upload .file-upload__label:hover:after,
    .file-upload.active .file-upload__label:after {
        color: #333;
    }

    .file-upload #file-upload {
        display: none;
    }
</style>

<title>GetUserMedia demo</title>

<div class="container">
    <div class="h-100 p-5 text-bg-dark rounded-3">
        <h2>Speech to text APP</h2>
        <p>Real-time transcription playground using the Web Speech.</p>
        <div class="file-upload">
            <label for="file-upload" class="file-upload__label">Drag and drop</label>
            <input id="file-upload" type="file" multiple>
        </div>
        <div id="output" class="mt-5"></div>
    </div>
</div>

<script>
    const fileUpload = document.querySelector('.file-upload');

    fileUpload.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUpload.classList.add('active');
    });

    fileUpload.addEventListener('dragleave', () => {
        fileUpload.classList.remove('active');
    });

    fileUpload.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUpload.classList.remove('active');
        const files = e.dataTransfer.files;
        handleFiles(files);
        // show file name into the span tag
        document.getElementById('file-name').innerHTML = files[0].name;

    });

    const handleFiles = (files) => {
        // Handle the selected files here
    };
</script>

<script>
    const outputWrapper = document.querySelector('#output');

    async function fetchAPI() {
        let url = '/api/files/';
        let res = await fetch(url);
        let data = await res.json();
        return data.results;
    };

    async function wishperAction() {
        const transcribeData = await fetchAPI()
        transcribeData.forEach((item) => {
            outputWrapper.innerHTML += `
                <p class="ur">${item.transcript}</p>`;
        });
    };
    wishperAction();
</script>


<!-- <script>
    const speechButton = document.getElementById("speechStart");
    const outputElement = document.getElementById("output");
    const recognition = new window.webkitSpeechRecognition();

    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'en-US';

    speechButton.addEventListener("mousedown", function () {
        this.classList.add("btn-outline-danger");
        this.classList.remove("btn-outline-light");
        this.textContent = 'Stop'
        // recognition.start();
    });

    speechButton.addEventListener("mouseup", () => {
        speechButton.classList.remove("btn-outline-danger");
        speechButton.classList.add("btn-outline-light");
        speechButton.textContent = 'Speech'

        // recognition.stop();
    });

    recognition.addEventListener("result", function (event) {
        const result = event.results[event.results.length - 1][0].transcript;
        outputElement.textContent = result;
    });



    // fetch('/transcription/', {
    //     method: 'POST',
    //     body: JSON.stringify({ transcript }),
    //     headers: {
    //         'Content-Type': 'application/json',
    //         'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
    //     },
    // });


</script> -->


{% endblock %}